From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: DiaLight <light_01@rambler.ru>
Date: Thu, 11 Jul 2024 03:19:33 +0300
Subject: [PATCH] fix_mouse_pos_on_resized_window


diff --git a/dkii_exe_functions.cpp b/dkii_exe_functions.cpp
index 0000000..0000000 100644
--- a/dkii_exe_functions.cpp
+++ b/dkii_exe_functions.cpp
@@ -76,6 +76,23 @@ namespace {
 }
 
 LRESULT dk2::CWindowTest_proc(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam) {
+    // patch fix_mouse_pos_on_resized_window
+    switch (Msg) {
+        case WM_SIZE: {
+            clientSize = {LOWORD(lParam), HIWORD(lParam)};
+            break;
+        }
+        case WM_MOUSEMOVE: {
+            dk2::Pos2i pos = {GET_X_LPARAM(lParam), GET_Y_LPARAM(lParam)};
+            dk2::AABB renderRect = dk2::MyInputManagerCb_instance.f60_mouse->f30_aabb;
+            dk2::Pos2i renderSize = {renderRect.maxX - renderRect.minX, renderRect.maxY - renderRect.minY};
+            pos.x = (int) ((float) pos.x * (float) renderSize.x / (float) clientSize.x);
+            pos.y = (int) ((float) pos.y * (float) renderSize.y / (float) clientSize.y);
+            lParam = (pos.x & 0xFFFF) | ((pos.y & 0xFFFF) << 16);
+            break;
+        }
+    }
+    // end of patch fix_mouse_pos_on_resized_window
     // patch fix_keyboard_state_on_alt_tab
     switch(Msg) {
         case WM_ACTIVATEAPP:
